[
  {
    "projectId": "9bb8f686-60c6-4194-ab03-9c2e7da76163",
    "testId": "c2cfe707-8c52-479f-a441-3b2fddfc1c2d",
    "userId": "04880478-6021-70e6-d48a-31e15e7fa851",
    "title": "backend-test-plan-001-LinkedIn Content Intelligence System Backend Tests",
    "description": "Backend API test plan for LinkedIn Content Intelligence System",
    "code": "import requests\n\nBASE_URL = \"http://localhost:8080\"\nTIMEOUT = 30\n\n# For testing, use a placeholder valid and invalid JWT token\nVALID_JWT_TOKEN = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.validpayload.validsignature\"\nINVALID_JWT_TOKEN = \"invalid.token.value\"\n\ndef test_linkedin_content_intelligence_system_backend():\n    # 1. Health Check Endpoint\n    try:\n        resp = requests.get(f\"{BASE_URL}/health\", timeout=TIMEOUT)\n        resp.raise_for_status()\n        health_data = resp.json()\n        assert \"api\" in health_data, \"Missing 'api' status in health check response\"\n        assert \"clerk\" in health_data, \"Missing 'clerk' status in health check response\"\n        assert \"supabase\" in health_data, \"Missing 'supabase' status in health check response\"\n    except Exception as e:\n        assert False, f\"Health check failed: {e}\"\n\n    # 2. Authentication - valid token\n    headers = {\"Authorization\": f\"Bearer {VALID_JWT_TOKEN}\"}\n    try:\n        resp = requests.get(f\"{BASE_URL}/user/profile\", headers=headers, timeout=TIMEOUT)\n        resp.raise_for_status()\n        profile = resp.json()\n        assert \"id\" in profile, \"User profile should have 'id'\"\n    except Exception as e:\n        assert False, f\"Authenticated user profile fetch failed: {e}\"\n\n    # 3. Authentication - invalid token\n    headers_invalid = {\"Authorization\": f\"Bearer {INVALID_JWT_TOKEN}\"}\n    resp = requests.get(f\"{BASE_URL}/user/profile\", headers=headers_invalid, timeout=TIMEOUT)\n    assert resp.status_code == 401, \"Invalid token must return 401 Unauthorized\"\n\n    # 4. User Onboarding - submit questionnaire, create profile, check status\n    onboarding_payload = {\n        \"responses\": {\n            \"experience\": \"5 years in marketing\",\n            \"industry\": \"Technology\",\n            \"goals\": \"Increase engagement on LinkedIn\"\n        }\n    }\n    try:\n        # Submit onboarding questionnaire\n        resp = requests.post(f\"{BASE_URL}/user/onboarding\", json=onboarding_payload, headers=headers, timeout=TIMEOUT)\n        resp.raise_for_status()\n        onboarding_resp = resp.json()\n        user_id = onboarding_resp.get(\"user_id\")\n        assert user_id is not None, \"Onboarding response must contain user_id\"\n\n        # Get user profile to verify creation and onboarding status\n        resp = requests.get(f\"{BASE_URL}/user/profile\", headers=headers, timeout=TIMEOUT)\n        resp.raise_for_status()\n        profile = resp.json()\n        assert profile.get(\"onboarding_completed\") is True, \"User onboarding_completed should be True\"\n\n    except Exception as e:\n        assert False, f\"User onboarding flow failed: {e}\"\n\n    # 5. Content Generation - generate post draft and retrieve by status\n    post_payload = {\n        \"topic\": \"AI in Marketing\",\n        \"profile_id\": user_id\n    }\n    try:\n        # Generate post draft\n        resp = requests.post(f\"{BASE_URL}/posts/generate\", json=post_payload, headers=headers, timeout=TIMEOUT)\n        resp.raise_for_status()\n        post_resp = resp.json()\n        post_id = post_resp.get(\"post_id\")\n        assert post_id is not None, \"Generated post response must contain post_id\"\n        assert post_resp.get(\"status\") == \"draft\", \"Generated post must have status 'draft'\"\n\n        # Retrieve posts by status=draft\n        resp = requests.get(f\"{BASE_URL}/posts?status=draft\", headers=headers, timeout=TIMEOUT)\n        resp.raise_for_status()\n        posts_list = resp.json()\n        assert any(p.get(\"post_id\") == post_id for p in posts_list), \"Draft posts should include the generated post\"\n\n    except Exception as e:\n        assert False, f\"Content generation flow failed: {e}\"\n\n    # 6. LinkedIn Integration - store OAuth token, check connection status\n    linked_in_oauth_payload = {\n        \"access_token\": \"linkedin_oauth_dummy_token\",\n        \"expires_in\": 3600\n    }\n    try:\n        # Store LinkedIn OAuth token\n        resp = requests.post(f\"{BASE_URL}/linkedin/token\", json=linked_in_oauth_payload, headers=headers, timeout=TIMEOUT)\n        resp.raise_for_status()\n        token_resp = resp.json()\n        assert token_resp.get(\"success\") is True, \"Storing LinkedIn OAuth token should be successful\"\n\n        # Check LinkedIn connection status\n        resp = requests.get(f\"{BASE_URL}/linkedin/status\", headers=headers, timeout=TIMEOUT)\n        resp.raise_for_status()\n        status_resp = resp.json()\n        assert \"connected\" in status_resp, \"LinkedIn status response must include 'connected'\"\n        assert isinstance(status_resp[\"connected\"], bool), \"'connected' must be a boolean\"\n\n    except Exception as e:\n        assert False, f\"LinkedIn integration tests failed: {e}\"\n\ntest_linkedin_content_intelligence_system_backend()",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"<string>\", line 16, in test_linkedin_content_intelligence_system_backend\nAssertionError: Missing 'api' status in health check response\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 107, in <module>\n  File \"<string>\", line 20, in test_linkedin_content_intelligence_system_backend\nAssertionError: Health check failed: Missing 'api' status in health check response\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-10-27T14:25:24.370Z",
    "modified": "2025-10-27T14:25:46.770Z"
  }
]
